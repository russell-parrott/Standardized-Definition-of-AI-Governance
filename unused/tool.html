<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Standardized Definition of AI Governance</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				font-size:1.1em;
				line-height: 1.4;
				color: #333333;
				background: #FFF;
			}
			
			h3{border-bottom:1px solid; margin-bottom:0.5rem; padding-bottom:0.5rem}
			select{font-size:1.1em;padding:0.5rem;}
			ul {font-size:1.1em;margin:0; padding:0; list-style:none}
			li{border-bottom:1px solid; margin-bottom:0.5rem; padding-bottom:0.5rem;}
			li:last-of-type{border-bottom:none; margin-bottom:0; padding-bottom:0rem;}
			
			.grid{align-content:start;align-items:start;display:grid; gap:2rem; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));margin:2rem;}
			.gird-box{ border:1px solid; border-radius:0.5rem; margin-bottom:0.5rem; padding:1rem;}
		</style>
	</head>
	<body>
		

		<!-- Assumes these exist somewhere in your HTML -->
		
		<select id="countries"></select>
		<select id="tests"></select>
		<select id="standard"></select>
		<div id="results"></div>

<script>

/* ---------- State ---------- */
let legals = [];
let standards = [];
let testsList = []; // ["T1","T2",...]
const state = { test: "", country: "", sector: "", standard: "" };
let testsObj = {}; // keyed by "T1","T2",...


/* ---------- Boot ---------- */
Promise.all([
  fetch('./legals.json').then(r => r.json()).catch(() => null),
  fetch('./standards.json').then(r => r.json()).catch(() => null),
  // Optional: if you have tests.json with ["T1","T2",...], it will override computed list
  fetch('./tests.json').then(r => r.ok ? r.json() : null).catch(() => null),
]).then(([legalsData, standardsData, testsData]) => {
  if (legalsData?.sectors) legals = legalsData.sectors;
  if (Array.isArray(standardsData)) standards = standardsData;
  if (testsData && typeof testsData === 'object') testsObj = testsData;
  // Build lists
  const countries = extractCountries(legals);
  const sectors = extractSectors(legals);
  const standardsNames = extractStandards(standards);
  const computedTests = buildTestsFromData(legals, standards);
  testsList = Array.isArray(testsData) && testsData.length ? normalizeTestArray(testsData) : computedTests;
  // Populate dropdowns
  populateSelect('tests', [''], testsList);
  populateSelect('countries', [''], countries);
  //populateSelect('sector', [''], sectors);
  populateSelect('standard', [''], standardsNames);
  // Wire listeners (blank page until a change)
  ['tests','countries','standard'].forEach(id => {
    document.getElementById(id).addEventListener('change', onFiltersChanged);
  });
});


/* ---------- UI Helpers ---------- */
function populateSelect(id, prefixValues, values) {
  const sel = document.getElementById(id);
  sel.innerHTML = ''; // reset
  [...prefixValues, ...values].forEach(v => {
    const opt = document.createElement('option');
    opt.value = v; opt.textContent = v || '— All —';
    sel.appendChild(opt);
  });
}

function onFiltersChanged() {
  state.test = document.getElementById('tests').value;        // "T2" or ""
  state.country = document.getElementById('countries').value;  // exact country or ""
  //state.sector = document.getElementById('sector').value;      // exact sector or ""
  state.standard = document.getElementById('standard').value;  // exact standard or ""

  const matches = runFilter(state);
  renderResults(matches);
}

/* ---------- Filtering ---------- */
function runFilter({ test, country, sector, standard }) {
  const out = { legals: [], standards: [] };

  // LEGALS
  if (legals.length) {
    legals.forEach(sec => {
      if (sector && sec.sector !== sector) return;

      const countries = (sec.countries || []).filter(c => {
        const countryOk = !country || c.country === country;
        const testOk = !test || c.test?.some(t => expandTestEntry(t).includes(test));
        return countryOk && testOk;
      });

      if (countries.length) out.legals.push({ sector: sec.sector, countries });
    });
  }

  // STANDARDS
  if (standards.length) {
    const testNum = test ? parseInt(test.replace('T',''), 10) : null;

    standards.forEach(std => {
      if (standard && std.standard !== standard) return;

      const refs = (std.references || []).filter(r => {
        if (!testNum) return true;
        return Array.isArray(r.test) && r.test.includes(testNum);
      });

      if (refs.length) out.standards.push({ standard: std.standard, references: refs });
    });
  }

  return out;
}

/* ---------- Render ---------- */
function renderResults({ legals, standards }) {
	const el = document.getElementById('results');
	el.innerHTML = ''; // clear
	if (!legals.length && !standards.length) {
		// Keep blank if no filters or no matches
		return;
	}

	const wrap = document.createElement('div');
	wrap.classList.add('grid')
		
	const testInfo = renderTestInfo(state.test);
	if (testInfo) wrap.appendChild(testInfo);
	
	  // Legals section
	const legalsBox = document.createElement('div');
	legalsBox.innerHTML = `<h2>Legals</h2>`;
	legals.forEach(sec => {
		const secDiv = document.createElement('div');
		secDiv.classList.add('gird-box')
		secDiv.innerHTML = `<h3>${sec.sector}</h3>`;
		const list = document.createElement('ul');
		sec.countries.forEach(c => {
			const li = document.createElement('li');
			li.innerHTML = `<b>${c.country}</b>: ${c.laws || ''}`;
			list.appendChild(li);
		});
		secDiv.appendChild(list);
		legalsBox.appendChild(secDiv);
	});
	if (legals.length) wrap.appendChild(legalsBox);

	// Standards section
	const standardsBox = document.createElement('div');
	standardsBox.innerHTML = `<h2>Standards</h2>`;
	standards.forEach(std => {
		const stdDiv = document.createElement('div');
		stdDiv.classList.add('gird-box')
		stdDiv.innerHTML = `<h3>${std.standard}</h3>`;
		const list = document.createElement('ul');
		std.references.forEach(r => {
			const tests = Array.isArray(r.test) ? r.test.map(n => `T${n}`).join(', ') : '';
			const li = document.createElement('li');
			li.innerHTML = `<b>${r.related_requirement}</b> — ${r.notes || ''}`;
			list.appendChild(li);
		});
		stdDiv.appendChild(list);
		standardsBox.appendChild(stdDiv);
	});
	if (standards.length) wrap.appendChild(standardsBox);

	
	
  el.appendChild(wrap);
}

/* ---------- Extractors ---------- */
function extractCountries(legalSectors) {
  const s = new Set();
  (legalSectors || []).forEach(sec => (sec.countries || []).forEach(c => s.add(c.country)));
  return Array.from(s).sort((a,b) => a.localeCompare(b));
}
function extractSectors(legalSectors) {
  const s = new Set();
  (legalSectors || []).forEach(sec => s.add(sec.sector));
  return Array.from(s).sort((a,b) => a.localeCompare(b));
}
function extractStandards(stdArray) {
  const s = new Set();
  (stdArray || []).forEach(st => st.standard && s.add(st.standard));
  return Array.from(s).sort((a,b) => a.localeCompare(b));
}
function buildTestsFromData(legalSectors, stdArray) {
  const s = new Set();

  // From legals (strings + ranges like "T7–T10")
  (legalSectors || []).forEach(sec => (sec.countries || []).forEach(c => {
    (c.test || []).forEach(t => expandTestEntry(t).forEach(x => s.add(x)));
  }));

  // From standards (numbers like [1,2,22])
  (stdArray || []).forEach(st => (st.references || []).forEach(r => {
    (r.test || []).forEach(n => s.add(`T${n}`));
  }));

  // Sort by numeric value of Tn
  return Array.from(s)
    .map(t => ({ t, n: parseInt(t.replace('T',''), 10) }))
    .sort((a,b) => a.n - b.n)
    .map(o => `T${o.n}`);
}

/* ---------- Test utilities ---------- */
function expandTestEntry(entry) {
  // Handles "T3", "T7–T10" (en dash) and "T7-T10" (hyphen) defensively
  if (typeof entry !== 'string') return [];
  const sep = entry.includes('–') ? '–' : (entry.includes('-') ? '-' : null);
  if (!sep) return [entry.trim()];
  const [a,b] = entry.split(sep).map(s => s.trim());
  const start = parseInt(a.replace('T',''), 10);
  const end = parseInt(b.replace('T',''), 10);
  const out = [];
  for (let i = start; i <= end; i++) out.push(`T${i}`);
  return out;
}
function flattenTests(arr) {
  // Normalizes any mixture of "Tn" and "Tn–Tm" into an expanded sorted list
  const s = new Set();
  (arr || []).forEach(e => expandTestEntry(e).forEach(x => s.add(x)));
  return Array.from(s)
    .map(t => ({ t, n: parseInt(t.replace('T',''), 10) }))
    .sort((a,b) => a.n - b.n)
    .map(o => `T${o.n}`);
}
function normalizeTestArray(a) {
  // Ensures ["T1","T02",2] => ["T1","T2",...]
  const s = new Set();
  (a || []).forEach(v => {
    if (typeof v === 'number') s.add(`T${v}`);
    else if (typeof v === 'string') {
      const m = v.match(/T?\s*(\d+)/i);
      if (m) s.add(`T${parseInt(m[1],10)}`);
    }
  });
  return Array.from(s)
    .map(t => ({ t, n: parseInt(t.replace('T',''), 10) }))
    .sort((a,b) => a.n - b.n)
    .map(o => `T${o.n}`);
}

function renderTestInfo(testKey) {
	if (!testKey || !testsObj[testKey]) return null;
	const t = testsObj[testKey]; 
	// { name, patterns: [{pattern, evasion_mechanism, resilience_verification, failure_observation}] }
	const box = document.createElement('div');
	box.innerHTML = `<h2>Test ${testKey}: ${t.name || ''}</h2>`;
	const box1 = document.createElement('div');
	box1.classList.add('gird-box');
	const list = document.createElement('ul');
	(t.patterns || []).forEach(p => {		
		const li = document.createElement('li');
		li.innerHTML = `
		<h3>Pattern: ${p.pattern || ''}</h3>
		<div><b>Evasion:</b> ${p.evasion_mechanism || ''}</div>
		<div><b>Verification:</b> ${p.resilience_verification || ''}</div>
		<div><b>Failure:</b> ${p.failure_observation || ''}</div>`;
		list.appendChild(li);		
	});
	box1.appendChild(list);
	box.appendChild(box1);
	return box;
}
</script>

		
	</body>
</html>